<html>

<head>

<title>Assignment</title>
<script src="https://d3js.org/d3.v4.js"></script>
<style>

div {
	width: 200px;
}

table {
  width: 200px;
  table-layout:fixed; 
}

thead {
  width: 200px;
  table-layout:fixed; 
}

tbody {
  width: 200px;
  table-layout:fixed; 
}

tr{
  width: 200px;
   table-layout:fixed; 
}

th{
  width: 200px;
}

td {
 width: 50%;
 border: 1px solid blue;
 text-align: center;
}

td.name {
  background-color: red;
}

td.value {
  background-color: lightgreen;
}

</style>
</head>

<body>

<h1>2ยบ Assignment</h1>

<h3>Render a box-plot with the data contained in the data1.csv file, showing also one point for each value of the data (use horizontal jitter).</h3>

<div id="boxplot"></div>

<h3>Plot automatically a data table by selecting the data from the files data1.csv, data2.csv and data3.csv (Use an html "select" tag and the onchange event).</h3>

<form>
		<label>File: <select id="filename" onchange="load_table(this.value);">
			<option value="data/data1.csv" selected>data1</option>
			<option value="data/data2.csv">data2</option>
			<option value="data/data3.csv">data3</option>
		</select></label>

</form>  
       
<div id="table"></div>

<svg height="200" width="200"></svg>

<h3>Render a bar-chart with the data contained in one column of data2.csv by allowing the user to select a column with a mouse-click of it.</h3>
<div id='barplot'></div>

<h3>Make a multiple box-plot for each column of the file data3.csv (that is, use only one y-axis and place them in an x-axis of type d3.scaleBand()).</h3>
<div id='multibox'></div>

<script>
<!-- 
d3.csv("data/data1.csv", function(data){
  
  var dd = data.map(d => + d.value);
  boxplot(dd);
   
})
 -->

function boxplot(data) {
	// set the dimensions and margins of the graph
	var margin = {top: 10, right: 30, bottom: 30, left: 40},
	  width = 400 - margin.left - margin.right,
	  height = 400 - margin.top - margin.bottom;

	// append the svg object to the body of the page
	var svg = d3.select("#boxplot")
	  .append("svg")
	  .attr("width", width + margin.left + margin.right)
	  .attr("height", height + margin.top + margin.bottom)
	  .append("g")
	  .attr("transform",
			"translate(" + margin.left + "," + margin.top + ")");

	// Compute summary statistics used for the box:
	var data_sorted = data.sort(d3.ascending)
	var q1 = d3.quantile(data_sorted, .25)
	var median = d3.quantile(data_sorted, .5)
	var q3 = d3.quantile(data_sorted, .75)
	var interQuantileRange = q3 - q1
	var min = q1 - 1.5 * interQuantileRange
	var max = q1 + 1.5 * interQuantileRange

	// Show the Y scale
	var y = d3.scaleLinear()
	  .domain([min * 0.9, max * 1.1])
	  .range([height, 0]);
	svg.call(d3.axisLeft(y))

	// a few features for the box
	var center = 200
	var width = 100

	// Show the main vertical line
	svg
	  .append("line")
	  .attr("x1", center)
	  .attr("x2", center)
	  .attr("y1", y(min) )
	  .attr("y2", y(max) )
	  .attr("stroke", "black")

	// Show the box
	svg
	  .append("rect")
	  .attr("x", center - width/2)
	  .attr("y", y(q3) )
	  .attr("height", (y(q1)-y(q3)) )
	  .attr("width", width )
	  .attr("stroke", "black")
	  .style("fill", "#69b3a2")

	// show median, min and max horizontal lines
	svg
	  .selectAll("toto")
	  .data([min, median, max])
	  .enter()
	  .append("line")
	  .attr("x1", center-width/2)
	  .attr("x2", center+width/2)
	  .attr("y1", function(d){ return(y(d))} )
	  .attr("y2", function(d){ return(y(d))} )
	  .attr("stroke", "black")
	  
}

function load_table(data_name){


	//This might be easier by using the normal table code of the teacher and separating each case by an if 
	//But that seems like a bad solution
	  
	var tabulate = function (data,columns) {
	  var table =  d3.select("#table")
	  table
			.attr('width', 400)
			.attr('height', 400)
			
		var thead = table.append('thead')
		var tbody = table.append('tbody')

		thead.append('tr')
		  .selectAll('th')
			.data(columns)
			.enter()
		  .append('th')
			.text(function (d) { return d })

		var rows = tbody.selectAll('tr')
			.data(data)
			.enter()
		  .append('tr')

		var cells = rows.selectAll('td')
			.data(function(row) {
				return columns.map(function (column) {
					return { column: column, value: row[column] }
			  })
		  })
		  .enter()
		.append('td')
		  .text(function (d) { return d.value })

	  return table;
	}

	d3.csv(data_name,function (data) {
		if (data_name === 'data/data1.csv') {
		var columns = ['value','name']
		}
		if (data_name === 'data/data2.csv') {
		var columns = ['x','y','name']
		}
		if (data_name === 'data/data3.csv') {
		var columns = ['color','length','height','name']
		}
		
	  tabulate(data,columns)
	})
}

</script>

</body>
</html>